---
title: MySql数据库单表查询
date: 2022-6-20 19:39:05
cover: 
tags:
- note
---
很多高性能的应用都会对关联查询进行分解。简单地，可以对每个表进行一次单表查询，然后将结果在应用程序中进行关联。例如，下面这个查询：

```java
select * from tag
        join tag_post on tag_post.tag_id=tag.id
        join post on tag_post.post_id=post.id
        where tag.tag='mysql';
```
可以分解成下面这些查询来代替：

```java
Select * from tag where tag='mysql';
Select * from tag_post where tag_id=1234;
Select * from post where id in(123,456,567,9989,8909);
```

事实上，用分解关联查询的方式重构查询具有如下优势：（高并发、高性能的应用中，一般建议使用单表查询）
1. 让缓存的效率更高。许多应用程序可以方便地缓存单表查询对应的结果对象。另外对于 MySQL 的查询缓存来说，如果关联中的某个表发生了变化，那么就无法使用查询缓存了，而拆分后，如果某个表很少改变，那么基于该表的查询就可以重复利用查询缓存结果了。

2. 将查询分解后，执行单个查询可以减少锁的竞争。

3. 在应用层做关联，可以更容易对数据库进行拆分，更容易做到高性能和可扩展。

4. 查询本身效率也可能会有所提升。

5. 可以减少冗余记录的查询。

6. 更进一步，这样做相当于在应用中实现了哈希关联，而不是使用 MySQL 的嵌套环关联，某些场景哈希关联的效率更高很多。

7. 单表查询有利于后期数据量大了分库分表，如果联合查询的话，一旦分库，原来的 sql 都需要改动。

8. 上次看到某个 CTO 技术分享，公司规定底层禁止用 join 联合查询。数据大的时候确实慢。

9. 联合查询或许确实快，但是 mysql 的资源通常比程序代码的资源紧张的多。

