---
title: 子查询的七种类型
date: 2019-5-10 22:55:13
cover: https://blog-1258707945.cos.ap-guangzhou.myqcloud.com/img/20220510225713.png 
tags:
- mysql
---
# where 子查询
`查询单值`
查出每个栏目最新的商品(以good_id为最大为最新商品)：
```sql
select cat_id,good_id,good_name 
from goods 
where good_id 
in
(selct max(good_id) 
    from goods group by cat_id
);
```
# form 型子查询
`多行多列的结果集`
查出每个栏目最新的商品 (以 good_id 为最大为最新商品)
```sql
select * 
from (select cat_id,good_id,good_name 
      from goods order by cat_id asc, good_id desc)
      as tep group by cat_id;
```

# from
查出挂科 2 门及以上同学的平均分
```sql
# 1.先求出挂科两门以上及两门的同学
select name,count(*) as gk 
from stu where score<60 
group by name having gk>=2;
# 2.去除多余的一行
select name 
from (select name,count(*) as gk from stu 
where score<60 group by name having gk>=2)as tmp;
# 3.最终结果
select name ,avg(score) as '平均分' 
from stu where name in(select name from (select name,count(*) as gk 
from stu where score<60 group by name having gk>=2)as tmp)
group by name;
```
# in
查询年龄为 20 岁的员工部门
```sql
select * 
from department 
where did in(SELECT did from employee where age=20);
```

# exists
查询是否存在年龄大于 21 岁的员工
```sql
select * from department where EXISTS (SELECT did from employee where age>21);
```

# any 
查询满足条件的部门
```sql
select * from department where did> any (SELECT did from employee );
```

# all
查询满足条件的部门
```sql
select * from department where did> all(SELECT did from employee );
```


# 比较运算符子查询
查询赵四是哪个部门的
```sql
select * from department where did= all(SELECT did from employee where name='赵四'); 
```
# 总结：
**where 型子查询：指把内部查询的结果作为外层查询的比较条件。
from 型子查询：把内层的查询结果当成临时表，供外层 sql 再次查询。
in 子查询：内层查询语句仅返回一个数据列，这个数据列的值将供外层查询语句进行比较。
exists 子查询：把外层的查询结果，拿到内层，看内层是否成立，简单来说后面的返回 true, 外层（也就是前面的语句）才会执行，否则不执行。
any 子查询：只要满足内层子查询中的任意一个比较条件，就返回一个结果作为外层查询条件。
all 子查询：内层子查询返回的结果需同时满足所有内层查询条件。
比较运算符子查询：子查询中可以使用的比较运算符如 “>” “<” “= ” “!=”**

