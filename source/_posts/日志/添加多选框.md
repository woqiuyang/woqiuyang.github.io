---
title: 应付管理自定义表单添加多选框
date: 2022-6-22 17:20:19
cover: 
tags:
- 日志
---

```javascript
<template>
  <div class="cost-list">
    <ws-list-panel
      :loading="loading"
      :data="list"
      :columns="columns"
      :selection="true"
      :page-num="pageNum"
      :page-size="pageSize"
      :total="total"
      :pageSizes="[10]"
      :reset="false"
      @size-change="handleSizeChange"
      @detail-click="handleDetailGoto"
      @detail-click-dialog="handleDetail"
      @detail-click-writeoff="writeOffDetail"
      @edit-click="editDetailClick"
      @certificate-click="handleCertificateDetail"
      @current-change="handleCurrentChange"
      @handleConfirm="handleConfirm"
      @selection-change="handleSelection"
    >
      <template slot="title">
        <ws-data-search
          ref="filters"
          :filters="filters"
          :loading="loading"
          @search="dataSearch"
          :showMore="true"
        ></ws-data-search>
      </template>
      <template slot="operation">
        <div>
          <el-dropdown
            trigger="click"
            size="mini"
            type="primary"
            v-for="(item, index) in commandList"
            :key="index"
            :v-permission="item.permission"
            style="margin-right:10px;"
            @command="handleCommand($event, item)"
          >
            <el-button type="primary">{{ item.titleName }} <i class="el-icon-arrow-down"></i> </el-button>
            <el-dropdown-menu slot="dropdown">
              <el-dropdown-item command="select">按选择{{ item.opt }}</el-dropdown-item>
              <el-dropdown-item command="query">按条件{{ item.opt }}</el-dropdown-item>
              <el-dropdown-item command="input">按录入{{ item.opt }}</el-dropdown-item>
              <el-dropdown-item command="scene" v-if="item.type === 'certificate'"
                >按场景{{ item.opt }}</el-dropdown-item
              >
            </el-dropdown-menu>
          </el-dropdown>
        </div>
        <el-button
          type="primary"
          size="mini"
          icon=""
          v-permission="payConfirmPermission"
          v-if="payConfirmShow"
          @click="handlePayConfirm"
          >{{ confirmTitle }}</el-button
        >
        <el-button
          type="primary"
          size="mini"
          icon="el-icon-download"
          v-if="payConfirmShow"
          v-permission="uploadPermission"
          @click="handleMulDownload"
          >下载导入模板</el-button
        >
        <el-button type="primary" size="mini" v-if="bankDataShow" @click="handleProvisionInfo">月底计提</el-button>
        <el-button
          type="primary"
          size="mini"
          icon="el-icon-download"
          v-if="payConfirmShow"
          v-permission="uploadPermission"
          @click="handleImport"
          :loading="importing"
          >{{ importBtnName }}</el-button
        >
        <!-- <el-button type="primary" size="mini" icon="" v-permission="generateCertificatePermission" @click="handleMulOpt"
          >生成凭证</el-button
        >
        <el-button type="primary" size="mini" icon="" v-permission="" @click="conditionCertificateCreate"
          >按查询条件生成凭证</el-button
        >
        <el-button
          type="primary"
          size="mini"
          v-if="payConfirmShow"
          icon=""
          permission="fap:accounting:business:head:delete"
          @click="batchDelete"
          >批量删除</el-button
        > -->
        <el-button
          type="primary"
          :plain="true"
          size="mini"
          icon="el-icon-bottom"
          v-permission="downloadPermission"
          @click="handleExport"
        >
          导 出
        </el-button>
        <input ref="file" type="file" class="hide" @change="fileChange" />
        <el-dialog
          title="批量生成凭证"
          :visible.sync="showConditionDialog"
          width="700px"
          class="confirm-form"
          :close-on-click-modal="false"
        >
          请确认是否按所选的查询条件批量生成凭证
          <div slot="footer" class="dialog-footer">
            <el-button size="mini" @click="showConditionDialog = false">取 消</el-button>
            <el-button type="primary" size="mini" @click="conditionHandleMulOpt">
              确 认
            </el-button>
          </div>
        </el-dialog>
      </template>
    </ws-list-panel>
    <el-dialog
      title="明细"
      :center="true"
      :visible.sync="showDetailDialog"
      width="1300px"
      class="confirm-form"
      :close-on-click-modal="false"
    >
      <CostListView :dialogDataId="dialogDataId" ref="costListView" />
      <div slot="footer" class="dialog-footer">
        <el-button size="mini" @click="showDetailDialog = false" type="primary">关 闭</el-button>
      </div>
    </el-dialog>
    <el-dialog
      title="凭证"
      :center="true"
      :visible.sync="showCertificateDialog"
      width="1300px"
      class="confirm-form"
      :close-on-click-modal="false"
    >
      <CostCertificateListView />
      <div slot="footer" class="dialog-footer">
        <el-button size="mini" @click="showCertificateDialog = false" type="primary">关 闭</el-button>
      </div>
    </el-dialog>
    <el-dialog
      title="核销信息"
      :center="true"
      :visible.sync="showWriteOffDialog"
      width="1300px"
      class="confirm-form"
      :close-on-click-modal="false"
    >
      <CostWriteOffListView :dialogDataId="writeOffDataId" ref="costWriteOffListView" />
      <div slot="footer" class="dialog-footer">
        <el-button size="mini" @click="showWriteOffDialog = false" type="primary">关 闭</el-button>
      </div>
    </el-dialog>
    <el-dialog
      :title="confirmTitle"
      :visible.sync="showConfirmDialog"
      width="750px"
      class="confirm-form-dialog"
      :close-on-click-modal="false"
    >
      <ws-form-wrapper :cols="2">
        <el-form :model="form" ref="form" :rules="rules" label-position="left" inline label-width="100px" size="mini">
          <el-form-item label="用途" prop="purposeType">
            <el-select
              size="mini"
              v-model="confirmForm.purposeType"
              placeholder="请选择"
              style="width: 178px"
              @change="changePurposeType"
            >
              <el-option v-for="item in purposeTypes" :key="item.orderNo" :label="item.text" :value="item.value">
              </el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="收付单号" prop="businessNo">
            <el-select
              size="mini"
              v-model="confirmForm.businessNo"
              placeholder="请选择"
              style="width: 178px"
              filterable
              @change="changeOrderNo"
            >
              <el-option v-for="item in orderNoOptions" :key="item.id" :label="item.businessNo" :value="item">
              </el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="收付单金额" prop="amount">
            <el-input size="mini" v-model="confirmForm.amount" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="收付单余额" prop="amount">
            <el-input size="mini" v-model="confirmForm.remainAmount" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="收付日期" prop="receiptTime">
            <el-date-picker
              size="mini"
              v-model="confirmForm.receiptTime"
              :disabled="true"
              type="date"
              style="width: 178px"
            />
          </el-form-item>
          <el-form-item label="会计日期" prop="accountTime">
            <el-date-picker size="mini" v-model="confirmForm.accountTime" type="date" style="width: 178px" />
          </el-form-item>
          <el-form-item label="公司" prop="companyName">
            <el-input size="mini" v-model="confirmForm.companyName" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="账户" prop="bankAccountNumber">
            <el-input size="mini" v-model="confirmForm.bankAccountNumber" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="账户名称" prop="bankAccountName">
            <el-input size="mini" v-model="confirmForm.bankAccountName" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="账户银行" prop="bankName">
            <el-input size="mini" v-model="confirmForm.bankName" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="备注" class="span-2">
            <el-input
              class="mark-input"
              size="mini"
              type="textarea"
              :disabled="true"
              :rows="1"
              v-model="confirmForm.remark"
              style="width: 580px"
            ></el-input>
          </el-form-item>
          <el-divider content-position="left"> 收付明细</el-divider>
          <el-form-item label="原结算金额">
            <el-input size="mini" v-model="confirmForm.remainAmountSum" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="未结算金额">
            <el-input size="mini" v-model="confirmForm.paymentAmountSum" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="总含税金额">
            <el-input size="mini" v-model="confirmForm.amountTotal" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="税金">
            <el-input size="mini" v-model="confirmForm.taxAmountTotal" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="不含税金额">
            <el-input size="mini" v-model="confirmForm.amountExcludingTaxTotal" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="其他金额">
            <el-input size="mini" v-model="confirmForm.otherAmountTotal" :disabled="true"></el-input>
          </el-form-item>
          <!-- <el-form-item label="容差">
            <el-input size="mini" v-model="form.remark" :disabled="true"></el-input>
          </el-form-item> -->
        </el-form>
        <ws-list-panel
          :loading="loading"
          :data="payConfirmList"
          :columns="PayColumns"
          :selection="false"
          :showPage="false"
          :disableHiddenCols="true"
        >
        </ws-list-panel>
      </ws-form-wrapper>
      <div slot="footer" class="dialog-footer">
        <el-button size="mini" @click="showConfirmDialog = false">取 消</el-button>
        <el-button type="primary" size="mini" :loading="confirmLoading" @click="doHandleConfirm">
          确 认
        </el-button>
      </div>
    </el-dialog>
    <el-dialog
      :title="this.correctType == 1 ? '冲正确认' : '冲销确认'"
      :visible.sync="showCorrentDialog"
      width="700px"
      class="confirm-form"
      :close-on-click-modal="false"
    >
      <template>
        <span style="color:red">*</span><span>会计日期：</span>
        <el-date-picker
          v-model="form.accountTime"
          type="date"
          value-format="timestamp"
          :clearable="false"
          placeholder="选择日期"
        >
        </el-date-picker> </template
      ><br /><br />
      请确认是否对此业务单据号[{{ this.form.businessNo }}]进行{{ this.correctType === '1' ? '冲正' : '冲销' }}
      <div slot="footer" class="dialog-footer">
        <el-button size="mini" @click="showCorrentDialog = false">取 消</el-button>
        <el-button type="primary" size="mini" @click="doHandleCorrent" v-permission="correctPermission">
          确 认
        </el-button>
      </div>
    </el-dialog>
    <el-dialog
      title="删除确认"
      :visible.sync="showDeleteDialog"
      width="700px"
      class="confirm-form"
      :close-on-click-modal="false"
    >
      <P style="text-align:center">请确认是否删除</P>
      <div slot="footer" class="dialog-footer">
        <el-button size="mini" @click="showDeleteDialog = false">取 消</el-button>
        <el-button type="primary" size="mini" @click="doHandleDelete" permission="">
          确 认
        </el-button>
      </div>
    </el-dialog>
    <el-dialog :title="commandTitle + '录入内容'" :visible.sync="commandDialog" width="400px">
      <el-input type="textarea" :rows="15" placeholder="请输入内容" v-model="commandTextarea"></el-input>
      <span slot="footer" class="dialog-footer">
        <el-button @click="handleCancel">取 消</el-button>
        <el-button type="primary" @click="handleInput">确 定</el-button>
      </span>
    </el-dialog>
    <el-dialog :title="'选择场景生成凭证'" :visible.sync="sceneDialog" width="400px">
      <el-form label-position="left" label-width="80px">
        <el-form-item label="选择场景">
          <el-select size="mini" style="width:270px" filterable v-model="sceneId" placeholder="请选择">
            <el-option
              v-for="item in sceneConfigList"
              :key="item.sceneId"
              :label="item.sceneName + '(' + item.sceneId + ')'"
              :value="item.sceneId"
            ></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="录入内容">
          <el-input type="textarea" :rows="15" placeholder="请输入单据列表" v-model="commandTextarea"></el-input>
        </el-form-item>
      </el-form>
      <span slot="footer" class="dialog-footer">
        <el-button @click="sceneDialog = false">取 消</el-button>
        <el-button type="primary" @click="handleSceneCertificate">确 定</el-button>
      </span>
    </el-dialog>
    <el-dialog :title="commandTitle + '录入内容'" :visible.sync="hubCommandDialog" width="400px">
      <el-form
        ref="changeStatusForm"
        :model="hubchangeForm"
        :rules="hubchangeRules"
        label-position="left"
        label-width="80px"
      >
        <el-form-item label="会计日期" prop="hubaccountTime">
          <el-date-picker
            v-model="hubchangeForm.hubaccountTime"
            type="date"
            value-format="timestamp"
            :clearable="false"
            placeholder="选择日期"
          >
          </el-date-picker>
        </el-form-item>
        <el-form-item label="录入内容" prop="textarea" v-if="buttonType === 'input'">
          <el-input type="textarea" :rows="15" placeholder="请输入内容" v-model="hubchangeForm.textarea"></el-input>
        </el-form-item>
      </el-form>
      <span slot="footer" class="dialog-footer">
        <el-button @click="hubhandleCancel">取 消</el-button>
        <el-button type="primary" @click="hubhandleInput">确 定</el-button>
      </span>
    </el-dialog>
    <el-dialog title="请选择计提月份" :visible.sync="provisionFormDialog" width="500px">
      <el-form :model="provisionForm" label-position="left" label-width="80px">
        <el-form-item label="会计月份">
          <el-date-picker
            v-model="provisionForm.accountMonth"
            type="month"
            value-format="yyyy-MM"
            :clearable="false"
            placeholder="会计月份"
          >
          </el-date-picker>
          <el-button @click="getProvisionInfo">查看计提信息</el-button>
        </el-form-item>
        <el-form-item label="计提信息" class="span-2">
          <el-input
            class="mark-input"
            size="mini"
            type="textarea"
            :disabled="false"
            :rows="5"
            v-model="provisionForm.info"
            style="width: 350px"
          ></el-input>
        </el-form-item>
      </el-form>
      <span slot="footer" class="dialog-footer">
        <el-button @click="provisionFormCancel">取 消</el-button>
        <el-button type="primary" @click="doProvision">确定计提</el-button>
      </span>
    </el-dialog>
    <el-dialog
      title="修改单据"
      :center="true"
      :visible.sync="showEditDetailDialog"
      width="1300px"
      class="confirm-form"
      :close-on-click-modal="false"
    >
      <ws-form-wrapper :cols="2">
        <el-form
          :model="detailForm"
          ref="detailForm"
          :rules="detailrules"
          label-position="left"
          inline
          class="detail-form"
          label-width="100px"
          size="mini"
        >
          <el-form-item label="业务单据号" prop="businessNo">
            <el-input size="mini" v-model="detailForm.businessNo" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="业务类型" prop="businessTypeName">
            <el-input size="mini" v-model="detailForm.businessTypeName" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="冲正序号" prop="correctingNo">
            <el-input
              size="mini"
              type="text"
              v-model="detailForm.correctingNo"
              :disabled="this.form.id !== ''"
            ></el-input>
          </el-form-item>
          <el-form-item label="单据类型" prop="orderTypeName">
            <el-input size="mini" v-model="detailForm.orderTypeName" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="公司" prop="companyName">
            <el-input size="mini" v-model="detailForm.companyName" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="往来单位1" prop="contactUnit1">
            <el-select size="mini" filterable v-model="detailForm.contactUnit1" placeholder="请选择">
              <el-option
                v-for="item in contactUnitOptions"
                :key="item.unitCode"
                :label="item.unitName"
                :value="item.unitCode"
              ></el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="往来单位2">
            <el-select size="mini" filterable v-model="detailForm.contactUnit2" placeholder="请选择">
              <el-option
                v-for="item in contactUnitOptions"
                :key="item.unitCode"
                :label="item.unitName"
                :value="item.unitCode"
              ></el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="会计日期" prop="accountTime">
            <el-date-picker
              size="mini"
              v-model="detailForm.accountTime"
              :clearable="false"
              placeholder="选择日期"
              style="width: 178px"
            >
            </el-date-picker>
          </el-form-item>
          <el-form-item label="含税金额" prop="amount">
            <el-input size="mini" v-model="detailForm.amount" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="税金" prop="amountTax">
            <el-input size="mini" v-model="detailForm.amountTax" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="不含税金额" prop="amountExcludingTax">
            <el-input size="mini" v-model="detailForm.amountExcludingTax" :disabled="true"></el-input>
          </el-form-item>
          <el-form-item label="我方账户" prop="weAccountId">
            <el-select size="mini" filterable v-model="detailForm.weAccountId" placeholder="请选择">
              <el-option
                v-for="item in ascriptionFlagOptions1"
                :key="item.unitCode"
                :label="`${item.accountId}(${item.accountName})`"
                :value="item.accountId"
              ></el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="对方账户" prop="accountId">
            <el-select size="mini" filterable v-model="detailForm.accountId" placeholder="请选择">
              <el-option
                v-for="item in ascriptionFlagOptions2"
                :key="item.unitCode"
                :label="`${item.accountId}(${item.accountName})`"
                :value="item.accountId"
              ></el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="关联单号" prop="associateNo">
            <div class="el-input el-input--mini">
              <input
                size="mini"
                v-model.lazy="detailForm.associateNo"
                placeholder="请输入关联单号"
                class="el-input__inner"
              />
            </div>
          </el-form-item>
          <el-form-item label="备注" prop="summary">
            <div class="el-input el-input--mini">
              <textarea
                size="mini"
                v-model.lazy="detailForm.summary"
                placeholder="请输入备注"
                class="el-textarea__inner"
              ></textarea>
            </div>
          </el-form-item>
        </el-form>
      </ws-form-wrapper>
      <el-table :data="detailFormList" size="mini" border stripe height="200px" style="width: 100%">
        <template v-for="item in detailFormColumns">
          <el-table-column
            :show-overflow-tooltip="true"
            :key="item.property"
            :prop="item.property"
            :label="item.title"
            :width="item.width || undefined"
            v-if="!item.hidden"
          >
            <template slot-scope="scope">
              <span v-if="!item.type">{{ scope.row[item.property] }}</span>
              <span v-else-if="item.type === 'number'">{{ scope.row[item.property] | amountFilter }}</span>
              <el-input
                v-else-if="item.type === 'textarea'"
                size="mini"
                type="textarea"
                v-model="scope.row[item.property]"
              ></el-input>
              <el-select
                v-else-if="item.type === 'select'"
                size="mini"
                v-model="scope.row[item.property]"
                filterable
                clearable
                class="type-select"
                @select="handleSelectItem(scope.row, item)"
              >
                <el-option
                  v-for="option in item.selectOption || []"
                  :key="option[item.selectKey]"
                  :label="`${option[item.selectValue]}(${option[item.selectKey]})`"
                  :value="option[item.selectKey]"
                ></el-option>
              </el-select>
            </template>
          </el-table-column>
        </template>
      </el-table>
      <div slot="footer" class="dialog-footer">
        <el-button size="mini" @click="showEditDetailDialog = false" type="primary" plain>取 消</el-button>
        <el-button size="mini" @click="editSave" type="primary">确 认</el-button>
      </div>
    </el-dialog>
    <!-- <iframe :src="payDiaLog" frameborder="0"></iframe> -->
  </div>
</template>

<script>
import { mapState, mapActions } from 'vuex'
import { purposeTypes, getFileName, accountFlags, paymentFlags, paymentCheckFlags, YesNoNum, clientCodes } from '@/utils/dict' // orderOptions
import { kiloSplit, dateFormat, getParamsUrl } from '@/utils/utils'
import moment from 'moment'
import api from '@/utils/api'
import CostListView from '@/views/CostPay/CostListView'
import CostCertificateListView from '@/views/CostPay/CostCertificateListView'
import CostWriteOffListView from '@/views/CostPay/CostWriteOffListView'
export default {
  name: 'cost-list',
  components: {
    CostListView,
    CostCertificateListView,
    CostWriteOffListView
  },
  props: [
    // 'optColumn',
    'payConfirmPermission', // 收付确认
    'generateCertificatePermission', // 生成凭证
    'uploadPermission', // 导入
    'downloadPermission', // 导出
    'correctPermission', // 冲正
    'deletePermission', // 删除
    'provisionPermission', // 计提
    'orderTypeCodes',
    'businessTypeCodes',
    'fundDirect',
    'businessScope',
    'isShowEditOpt' // 显示修改按钮
  ],
  data () {
    return {
      accountFlags,
      commandTitle: '',
      commandDialog: false,
      sceneDialog: false,
      sceneId: '',
      sceneConfigList: [],
      hubCommandDialog: false,
      hubaccountTime: '',
      commandTextarea: '',
      commandType: '', // 按钮类型
      buttonType: '', // 下拉选择类型
      provisionFormDialog: false, // 月底计提提示框
      provisionForm: {
        accountMonth: '',
        info: '',
        fundDirect: ''
      },
      commandList: [
        {
          titleName: '删除',
          opt: '删除',
          type: 'delete',
          permission: 'deletePermission'
        },
        {
          titleName: '生成凭证',
          opt: '生成凭证',
          type: 'certificate',
          permission: 'generateCertificatePermission'
        },
        {
          titleName: '冲销',
          opt: '冲销',
          type: 'writeOff',
          permission: 'correctPermission'
        },
        {
          titleName: '冲正',
          opt: '冲正',
          type: 'correct',
          permission: 'correctPermission'
        }
      ],
      hubchangeForm: {
        hubaccountTime: '',
        textarea: ''
      },
      hubchangeRules: {
        hubaccountTime: [{ required: true, message: '必填', trigger: 'change' }],
        textarea: [{ required: true, message: '必填', trigger: 'blur' }]
      },
      purposeTypes,
      actions: [],
      deleteIds: [],
      importing: false,
      importDisplay: false,
      payConfirmShow: false,
      bankDataShow: false,
      confirmForm: {
        purposeType: '',
        businessNo: '',
        amount: '',
        companyName: '',
        bankAccountNumber: '',
        bankAccountName: '',
        remark: '',
        amountTotal: '',
        taxAmountTotal: '',
        orderTypeCode: '',
        amountExcludingTaxTotal: '',
        otherAmountTotal: '',
        receiptTime: '',
        accountTime: '',
        remainAmountSum: '',
        paymentAmountSum: '',
        remainAmount: '',
        id: ''
      },
      form: {
        businessNo: '',
        orderTypeCode: '',
        accountTime: ''
      },
      rules: {
        purposeType: [{ required: true, message: '请选择', trigger: 'blur' }],
        receiptPaymentNo: [{ required: true, message: '请选择', trigger: 'blur' }],
        amount: [{ required: true, message: '请输入', trigger: 'blur' }],
        remainAmount: [{ required: true, message: '请输入', trigger: 'blur' }],
        companyName: [{ required: true, message: '请填写', trigger: 'blur' }],
        bankAccountNumber: [{ required: true, message: '请选择', trigger: 'blur' }],
        bankAccountName: [{ required: true, message: '请选择', trigger: 'blur' }],
        receiptTime: [{ required: true, message: '请选择', trigger: 'blur' }],
        accountTime: [{ required: true, message: '请选择', trigger: 'blur' }],
        amountTotal: [{ required: true, message: '请输入', trigger: 'blur' }],
        taxAmountTotal: [{ required: true, message: '请填写', trigger: 'blur' }],
        bankName: [{ required: true, message: '请填写', trigger: 'blur' }],
        amountExcludingTaxTotal: [{ required: true, message: '请输入', trigger: 'blur' }],
        otherAmountTotal: [{ required: true, message: '请填写', trigger: 'blur' }]
      },
      loading: false,
      confirmLoading: false,
      refleshCb: () => {},
      selectOptions: [],
      showConditionDialog: false,
      columns: [
        {
          title: '业务类型',
          property: 'businessTypeName'
        },
        {
          title: '单据类型',
          property: 'orderTypeName'
        },
        {
          title: '公司代码',
          property: 'companyCode'
        },
        {
          title: '公司名称',
          property: 'companyName'
        },
        {
          title: '往来单位代码',
          property: 'contactUnit1',
          width: 120
        },
        {
          title: '往来单位名称',
          property: 'contactUnitName1',
          width: 120
        },
        {
          title: '业务单据号',
          property: 'businessNo',
          width: 140
        },
        {
          title: '冲正序号',
          property: 'correctingNo'
        },
        // {
        //   title: '收付单号',
        //   property: 'settlementNo',
        //   detail: true,
        //   width: 120
        // },
        {
          title: '核销方单号',
          property: 'writeOffNo',
          width: 120
        },
        {
          title: '核销方序号',
          property: 'writeOffCorrectingNo',
          width: 120
        },
        {
          title: '被核销方单号',
          property: 'writtenOffNo',
          width: 120
        },
        {
          title: '被核销方序号',
          property: 'writtenOffCorrectingNo',
          width: 120
        },
        {
          title: '关联单号',
          property: 'associateNo',
          width: 120
        },
        {
          title: '结算单号',
          property: 'settlementNo',
          width: 120
        },
        {
          title: '冲正有效标记',
          property: 'correctingFlag',
          width: 100,
          formatter: function (val) {
            return val.correctingFlag === 0 ? '否' : '是'
          }
        },
        {
          title: '税务单号',
          property: 'taxNo',
          hidden: true
        },
        {
          title: '币种',
          property: 'currency'
        },
        {
          title: '含税金额',
          property: 'amount',
          type: 'number',
          formatter: function (val) {
            if (val.amount !== '') {
              // return val.amount01
              return kiloSplit(val.amount)
            }
          }
        },
        {
          title: '税金',
          property: 'amountTax',
          type: 'number',
          formatter: function (val) {
            if (val.amountTax !== '') {
              // return val.amount01
              return kiloSplit(val.amountTax)
            }
          }
        },
        {
          title: '不含税金额',
          property: 'amountExcludingTax',
          type: 'number',
          width: 130,
          formatter: function (val) {
            if (val.amountExcludingTax !== '') {
              // return val.amount01
              return kiloSplit(val.amountExcludingTax)
            }
          }
        },
        {
          title: '其他金额',
          property: 'otherAmount',
          type: 'number',
          formatter: function (val) {
            if (val.otherAmount !== '') {
              // return val.amount01
              return kiloSplit(val.otherAmount)
            }
          }
        },
        {
          title: '结算金额',
          property: 'settlementAmount',
          type: 'number',
          formatter: function (val) {
            if (val.settlementAmount !== '') {
              // return val.amount01
              return kiloSplit(val.settlementAmount)
            }
          }
        },
        {
          property: 'businessTime',
          title: '业务时间',
          formatter: function (row) {
            return row.businessTime === undefined ? '' : dateFormat('yyyy-MM-dd hh:mm:ss', new Date(row.businessTime))
          },
          width: 100
        },
        {
          property: 'accountTime',
          title: '会计日期',
          formatter: function (row) {
            return row.accountTime === undefined ? '' : dateFormat('yyyy-MM-dd', new Date(row.accountTime))
          },
          width: 100
        },
        {
          property: 'paymentFlag',
          title: '收付标记',
          formatter: function (val) {
            if (val.paymentFlag === 0) {
              return '未收付'
            }
            if (val.paymentFlag === 1) {
              return '已收付'
            }
            if (val.paymentFlag === 2) {
              return '部分收付'
            }
            return ''
          }
        },
        {
          property: 'paymentTime',
          title: '收付时间',
          formatter: function (row) {
            return row.paymentFlag === 0 || row.paymentTime === undefined
              ? ''
              : dateFormat('yyyy-MM-dd hh:mm:ss', new Date(row.paymentTime))
          },
          width: 100
        },
        {
          property: 'accountFlag',
          title: '挂账标记 ',
          width: 100,
          formatter: function (val) {
            for (var i = 0; i < accountFlags.length; i++) {
              if (accountFlags[i].value === val.accountFlag) {
                return accountFlags[i].text
              }
            }
            return ''
          }
        },
        {
          property: 'taxAccountFlag',
          title: '税务记账标记',
          hidden: true,
          width: 100,
          formatter: function (val) {
            if (val.taxAccountFlag === 0) {
              return '未记账'
            }
            if (val.taxAccountFlag === 1) {
              return '已记账'
            }
            if (val.taxAccountFlag === 2) {
              return '出错'
            }
            return ''
          }
        },
        {
          title: '我方账户',
          property: 'weAccountId'
        },
        {
          title: '我方账户名称',
          property: 'weAccountName'
        },
        {
          title: '我方银行信息',
          property: 'weBankInfo'
        },
        {
          title: '收付方账户',
          width: 100,
          property: 'accountId'
        },
        {
          title: '收付方账户名称',
          property: 'accountName'
        },
        {
          title: '收付方银行信息',
          property: 'accountBankName'
        },
        {
          title: '说明',
          property: 'summary'
        },
        {
          title: '错误信息',
          property: 'errorMsg'
        },
        {
          property: 'taxAccountTime',
          title: '税务时间',
          formatter: 'datetime',
          hidden: true,
          datetimeFormat: 'YYYY-MM-DD HH:mm:ss',
          width: 100
        },
        {
          property: 'formerAccountTime',
          title: '原会计日期',
          formatter: function (row) {
            return row.formerAccountTime === undefined ? '' : dateFormat('yyyy-MM-dd', new Date(row.formerAccountTime))
          },
          width: 100
        },
        {
          property: 'clientCode',
          title: '来源',
          width: 100,
          formatter: function (val) {
            if (val.clientCode === 'FSS') {
              return '综合结算'
            }
            if (val.clientCode === 'FM') {
              return '费控'
            }
            if (val.clientCode === 'HLY') {
              return '汇联易'
            }
            if (val.clientCode === 'HANDWORK') {
              return '手工导入'
            }
            if (val.clientCode === 'ASSET') {
              return '资产'
            }
            if (val.clientCode === 'EBS') {
              return 'EBS导入'
            }
            if (val.clientCode === 'BANK') {
              return '银企直联'
            }
            return val.clientCode
          }
        },
        {
          title: '归档号',
          property: 'filingNo'
        },
        {
          title: '付款校验状态',
          property: 'paymentCheckFlag',
          hidden: true,
          width: 100,
          formatter: function (val) {
            if (val.paymentCheckFlag === 0) {
              return '待校验'
            }
            if (val.paymentCheckFlag === 1) {
              return '失败'
            }
            if (val.paymentCheckFlag === 2) {
              return '成功'
            }
            return ''
          }
        },
        {
          title: '付款校验失败原因',
          property: 'paymentCheckErrorMsg',
          hidden: true,
          width: 100
        },
        {
          title: '银企付款状态',
          property: 'approvalStatusCode',
          formatter: function (val) {
            if (val.approvalStatusCode === 0) {
              return '未付款'
            }
            if (val.approvalStatusCode === 1) {
              return '付款中'
            }
            if (val.approvalStatusCode === 4) {
              return '付款成功'
            }
            if (val.approvalStatusCode === 5) {
              return '付款失败'
            }
            return val.approvalStatusCode
          }
        },
        {
          property: 'operation',
          title: '操作',
          width: 200,
          fixed: 'right',
          actions: [
            { name: 'detail-click-dialog', permission: '', title: '明细' },
            { name: 'certificate-click', permission: '', title: '凭证' },
            { name: 'detail-click-writeoff', permission: '', title: '查看核销' },
            { name: 'edit-click', permission: '', title: '修改', show: v => v.correctingNo > 1 && this.isShowEditOpt && v.correctingFlag === 1 }
          ]
        }
      ],
      payConfirmList: [],
      PayColumns: [
        {
          title: '单据类型',
          property: 'orderTypeName'
        },
        {
          title: '业务单据号',
          property: 'businessNo'
        },
        {
          title: '含税金额',
          property: 'amount',
          type: 'number',
          formatter: function (val) {
            if (val.amount !== '') {
              // return val.amount01
              return kiloSplit(val.amount)
            }
          }
        },
        {
          title: '税金',
          property: 'amountTax',
          type: 'number',
          formatter: function (val) {
            if (val.amountTax !== '') {
              // return val.amount01
              return kiloSplit(val.amountTax)
            }
          }
        },
        {
          title: '不含税金额',
          property: 'amountExcludingTax',
          type: 'number',
          width: 130,
          formatter: function (val) {
            if (val.amountExcludingTax !== '') {
              // return val.amount01
              return kiloSplit(val.amountExcludingTax)
            }
          }
        },
        {
          title: '其他金额',
          property: 'otherAmount',
          type: 'number',
          formatter: function (val) {
            if (val.otherAmount !== '') {
              // return val.amount01
              return kiloSplit(val.otherAmount)
            }
          }
        },
        {
          title: '原结算金额',
          property: 'remainAmount',
          type: 'number',
          formatter: function (val) {
            if (val.remainAmount !== '') {
              // return val.amount01
              return kiloSplit(val.remainAmount)
            }
          }
        },
        {
          title: '未结算金额',
          property: 'paymentAmount',
          type: 'number',
          formatter: function (val) {
            if (val.paymentAmount !== '') {
              // return val.amount01
              return kiloSplit(val.paymentAmount)
            }
          }
        }
      ],
      pageNum: 1,
      pageSize: 10,
      showConfirmDialog: false,
      showCorrentDialog: false,
      showDetailDialog: false,
      showWriteOffDialog: false,
      showCertificateDialog: false,
      showDeleteDialog: false,
      correctType: '1',
      filters: [
        {
          type: 'select',
          id: '134b7fb4-1878-412e-a601-cdd5fba86f3b',
          title: '业务类型',
          name: 'businessTypeCode',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          regex: '',
          optionsType: 'local',
          options: [],
          optionsUrl: '',
          optionsParams: [],
          optionsTextProp: 'businessTypeName',
          optionsValueProp: 'businessTypeCode',
          multiple: false,
          disabled: false,
          clearable: true,
          placeholder: '请选择',
          validateError: [],
          listReadonlyList: {},
          hideDisabled: true
        },
        {
          type: 'select',
          id: '134b7fb4-1878-412e-a601-cdd5fba85f3b',
          title: '单据类型',
          name: 'orderTypeCode',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          regex: '',
          optionsType: 'local',
          options: [],
          optionsUrl: '',
          optionsParams: [],
          optionsTextProp: 'orderTypeName',
          optionsValueProp: 'orderTypeCode',
          multiple: false,
          disabled: false,
          clearable: true,
          placeholder: '请选择',
          validateError: [],
          listReadonlyList: {},
          hideDisabled: true
        },
        {
          type: 'input',
          id: '14169248-cd5a-4dd8-ba58-bdc1637a55e2',
          title: '公司名称',
          name: 'companyName',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          clickableInList: false,
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          validateError: {},
          regex: '',
          listReadonlyList: [],
          placeholder: '请输入',
          disabled: false,
          quickEdit: false,
          _editing: false,
          secret: false,
          clearable: true,
          hideDisabled: false
        },
        {
          type: 'input',
          id: '14169248-ae2a-4dd8-ba58-bdc1637b55e2',
          title: '往来单位名称',
          name: 'contactUnitName1',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          clickableInList: false,
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          validateError: {},
          regex: '',
          listReadonlyList: [],
          placeholder: '请输入',
          disabled: false,
          quickEdit: false,
          _editing: false,
          secret: false,
          clearable: true,
          hideDisabled: false
        },
        {
          type: 'input',
          id: '16969248-cd5a-4dd8-ba58-bdc1637a55e2',
          title: '业务单据号',
          name: 'businessNo',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          clickableInList: false,
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          validateError: {},
          regex: '',
          listReadonlyList: [],
          placeholder: '请输入',
          disabled: false,
          quickEdit: false,
          _editing: false,
          secret: false,
          clearable: true,
          hideDisabled: false
        },
        {
          type: 'select',
          id: '134b7fb4-1878-412e-a601-cdd5fba85f3b',
          title: '冲正有效标记',
          name: 'correctingFlag',
          default: 1,
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          regex: '',
          optionsType: 'local',
          options: YesNoNum,
          optionsUrl: '',
          optionsParams: [],
          optionsTextProp: 'text',
          optionsValueProp: 'value',
          multiple: false,
          disabled: false,
          clearable: true,
          placeholder: '请选择',
          validateError: [],
          listReadonlyList: {},
          hideDisabled: true
        },
        // {
        //   type: 'daterange',
        //   id: 'da9c99d3-05b5-45a7-ad67-5d938fa90109',
        //   title: '创建日期',
        //   name: 'sysCtimeRange',
        //   desc: '',
        //   span: 1,
        //   dependencyKey: '',
        //   dependencyValue: [],
        //   required: false,
        //   jumpRule: '',
        //   clickableInList: false,
        //   color: '',
        //   autoFillControls: [],
        //   autoFillApi: '',
        //   readonly: false,
        //   readonlyWhileCreate: false,
        //   hidden: false,
        //   hiddenWhileCreate: false,
        //   validateError: {},
        //   regex: '',
        //   listReadonlyList: [],
        //   dateFormat: '',
        //   defaultDateDefine: true,
        //   defaultDateUnit: ['days', 'days'],
        //   defaultDateNum: [0, 0],
        //   dateRangeType: 'daterange',
        //   disabled: false,
        //   clearable: true,
        //   hideDisabled: false
        // },
        {
          type: 'daterange',
          id: 'da9c99d3-05b5-45a7-ad67-5d938fa90109',
          title: '会计日期',
          name: 'accountTimeRange',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          clickableInList: false,
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          validateError: {},
          regex: '',
          listReadonlyList: [],
          dateFormat: '',
          defaultDateDefine: true,
          defaultDateUnit: ['days', 'days'],
          defaultDateNum: [0, 0],
          dateRangeType: 'daterange',
          disabled: false,
          clearable: true,
          hideDisabled: false
        },
        {
          type: 'select',
          id: '134b7fb4-1878-412e-a601-cdd5fba85f3b',
          title: '挂账标记',
          name: 'accountFlag',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          regex: '',
          optionsType: 'local',
          options: accountFlags,
          optionsUrl: '',
          optionsParams: [],
          optionsTextProp: 'text',
          optionsValueProp: 'value',
          multiple: false,
          disabled: false,
          clearable: true,
          placeholder: '请选择',
          validateError: [],
          listReadonlyList: {},
          hideDisabled: true
        },
        {
          type: 'input',
          id: '16969248-cd5a-4dd8-ba58-bdc1637a55e2',
          title: '结算单号',
          name: 'settlementNo',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          clickableInList: false,
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          validateError: {},
          regex: '',
          listReadonlyList: [],
          placeholder: '请输入',
          disabled: false,
          quickEdit: false,
          _editing: false,
          secret: false,
          clearable: true,
          hideDisabled: false
        },
        {
          type: 'number',
          id: 'ebbcee0d-9aa5-4c20-8257-584511ae503f',
          title: '含税金额',
          name: 'amountRange',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          clickableInList: false,
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          validateError: [],
          regex: '',
          placeholder: '请输入',
          disabled: false,
          precision: 0,
          controls: false,
          max: 999999999,
          min: -999999999,
          listReadonlyList: {},
          hideDisabled: true,
          clearable: true,
          isRange: true
        },
        {
          type: 'daterange',
          id: 'da9c99d3-05b5-45a7-ad67-5d938fa90109',
          title: '收付时间',
          name: 'paymentTimeRange',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          clickableInList: false,
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          validateError: {},
          regex: '',
          listReadonlyList: [],
          dateFormat: '',
          defaultDateDefine: true,
          defaultDateUnit: ['days', 'days'],
          defaultDateNum: [0, 0],
          dateRangeType: 'daterange',
          disabled: false,
          clearable: true,
          hideDisabled: false
        },
        {
          type: 'select',
          id: '134b7fb4-1878-412e-a601-cdd5fba85f3b',
          title: '收付标记',
          name: 'paymentFlag',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          regex: '',
          optionsType: 'local',
          options: paymentFlags,
          optionsUrl: '',
          optionsParams: [],
          optionsTextProp: 'text',
          optionsValueProp: 'value',
          multiple: false,
          disabled: false,
          clearable: true,
          placeholder: '请选择',
          validateError: [],
          listReadonlyList: {},
          hideDisabled: true
        },
        // {
        //   type: 'select',
        //   id: '134b7fb4-1878-412e-a601-cdd5fba85f3b',
        //   title: '收付记账标记',
        //   name: 'paymentAccountFlag',
        //   default: '',
        //   desc: '',
        //   span: 1,
        //   dependencyKey: '',
        //   dependencyValue: [],
        //   required: false,
        //   jumpRule: '',
        //   color: '',
        //   autoFillControls: [],
        //   autoFillApi: '',
        //   readonly: false,
        //   readonlyWhileCreate: false,
        //   hidden: false,
        //   hiddenWhileCreate: false,
        //   regex: '',
        //   optionsType: 'local',
        //   options: accountFlags,
        //   optionsUrl: '',
        //   optionsParams: [],
        //   optionsTextProp: 'text',
        //   optionsValueProp: 'value',
        //   multiple: false,
        //   disabled: false,
        //   clearable: true,
        //   placeholder: '请选择',
        //   validateError: [],
        //   listReadonlyList: {},
        //   hideDisabled: true
        // },
        // {
        //   type: 'select',
        //   id: '134b7fb4-1878-412e-a601-cdd5fba85f3b',
        //   title: '税务记账标记',
        //   name: 'taxAccountFlag',
        //   default: '',
        //   desc: '',
        //   span: 1,
        //   dependencyKey: '',
        //   dependencyValue: [],
        //   required: false,
        //   jumpRule: '',
        //   color: '',
        //   autoFillControls: [],
        //   autoFillApi: '',
        //   readonly: false,
        //   readonlyWhileCreate: false,
        //   hidden: false,
        //   hiddenWhileCreate: false,
        //   regex: '',
        //   optionsType: 'local',
        //   options: accountFlags,
        //   optionsUrl: '',
        //   optionsParams: [],
        //   optionsTextProp: 'text',
        //   optionsValueProp: 'value',
        //   multiple: false,
        //   disabled: false,
        //   clearable: true,
        //   placeholder: '请选择',
        //   validateError: [],
        //   listReadonlyList: {},
        //   hideDisabled: true
        // },
        {
          type: 'input',
          id: '14160148-cd5a-4dd8-ba58-bdc1637a55e2',
          title: '核销方单号',
          name: 'writeOffNo',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          clickableInList: false,
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          validateError: {},
          regex: '',
          listReadonlyList: [],
          placeholder: '请输入',
          disabled: false,
          quickEdit: false,
          _editing: false,
          secret: false,
          clearable: true,
          hideDisabled: false
        },
        {
          type: 'input',
          id: '16969248-cd5a-4dd8-ba58-bdc1637a55e2',
          title: '被核销方单号',
          name: 'writtenOffNo',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          clickableInList: false,
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          validateError: {},
          regex: '',
          listReadonlyList: [],
          placeholder: '请输入',
          disabled: false,
          quickEdit: false,
          _editing: false,
          secret: false,
          clearable: true,
          hideDisabled: false
        },
        {
          type: 'select',
          id: '134b7fb4-1812-412e-a601-cdd5fba85swq',
          title: '来源',
          name: 'clientCode',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          regex: '',
          optionsType: 'local',
          options: clientCodes,
          optionsUrl: '',
          optionsParams: [],
          optionsTextProp: 'text',
          optionsValueProp: 'value',
          multiple: false,
          disabled: false,
          clearable: true,
          placeholder: '请选择',
          validateError: [],
          listReadonlyList: {},
          hideDisabled: true
        },
        {
          type: 'input',
          id: '16969248-cd5a-4dd8-sd58-bdc1637a84rz',
          title: '归档号',
          name: 'filingNo',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          clickableInList: false,
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          validateError: {},
          regex: '',
          listReadonlyList: [],
          placeholder: '请输入',
          disabled: false,
          quickEdit: false,
          _editing: false,
          secret: false,
          clearable: true,
          hideDisabled: false
        },
        {
          type: 'input',
          id: '14160148-cd5a-4dd8-ba58-bdc1637a55e2',
          title: '关联单号',
          name: 'associateNo',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          clickableInList: false,
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          validateError: {},
          regex: '',
          listReadonlyList: [],
          placeholder: '请输入',
          disabled: false,
          quickEdit: false,
          _editing: false,
          secret: false,
          clearable: true,
          hideDisabled: false
        },
        {
          type: 'select',
          id: '134b7fb4-1878-412e-sxza-cdd5fba53f3c',
          title: '付款校验状态',
          name: 'paymentCheckFlag',
          default: '',
          desc: '',
          span: 1,
          dependencyKey: '',
          dependencyValue: [],
          required: false,
          jumpRule: '',
          color: '',
          autoFillControls: [],
          autoFillApi: '',
          readonly: false,
          readonlyWhileCreate: false,
          hidden: false,
          hiddenWhileCreate: false,
          regex: '',
          optionsType: 'local',
          options: paymentCheckFlags,
          optionsUrl: '',
          optionsParams: [],
          optionsTextProp: 'text',
          optionsValueProp: 'value',
          multiple: false,
          disabled: false,
          clearable: true,
          placeholder: '请选择',
          validateError: [],
          listReadonlyList: {},
          hideDisabled: true
        }
      ],
      handleRow: {},
      dialogDataId: {},
      writeOffDataId: {},
      orderNoOptions: [],
      showEditDetailDialog: false,
      detailFormNew: {
        businessNo: '',
        businessTypeName: '',
        orderTypeName: '',
        companyName: '',
        contactUnit1: '',
        contactUnitName1: '',
        contactUnit2: '',
        contactUnitName2: '',
        accountTime: '',
        amount: 0,
        amountTax: 0,
        amountExcludingTax: 0,
        weAccountId: '',
        accountId: '',
        associateNo: '',
        summary: ''
      },
      detailForm: {},
      detailrules: {
        correctingNo: [{ required: true, message: '请输入', trigger: 'blur' }],
        businessNo: [{ required: true, message: '请输入', trigger: 'blur' }],
        businessTypeName: [{ required: true, message: '请输入', trigger: 'blur' }],
        orderTypeName: [{ required: true, message: '请输入', trigger: 'blur' }],
        companyName: [{ required: true, message: '请输入', trigger: 'blur' }],
        contactUnit1: [{ required: true, message: '请输入', trigger: 'blur' }],
        contactUnit2: [{ required: true, message: '请输入', trigger: 'blur' }]
      },
      detailFormList: [],
      contactUnitOptions: [],
      ascriptionFlagOptions1: [],
      ascriptionFlagOptions2: [],
      feeTypeOption: [],
      costCenterDataOption: [],
      productDataOption: [],
      sceneOptions: []
    }
  },
  filters: {
    amountFilter (value) {
      if (value === '') return ''
      if (value !== '') {
        return kiloSplit(value)
      }
      return value
    }
  },
  computed: {
    ...mapState('costList', ['list', 'total', 'DialogList']),
    pageSource () {
      if (this.$route.path.indexOf('assets/business') !== -1) {
        return 'assetsBusiness'
      }
      return 'null'
    },
    importBtnName () {
      if (this.businessScope === 'writeoff') {
        return '导入核销关系'
      } else {
        return '导入业务单据'
      }
    },
    confirmTitle () {
      // if (this.$route.path.indexOf('payment') !== -1) {
      //   return '付款确认'
      // } else if (this.$route.path.indexOf('receipt') !== -1) {
      //   return '收款确认'
      // } else {
      //   return '收付确认'
      // }
      return '收付确认'
    },
    feeTypeOptions () {
      return this.feeTypeOption
    },
    costCenterDatas () {
      return this.costCenterDataOption
    },
    productDatas () {
      return this.productDataOption
    },
    detailFormColumns () {
      return [
        {
          title: '业务明细号',
          property: 'entryNo'
        },
        {
          title: '成本中心',
          property: 'costCenterCode',
          nameProperty: 'costCenterName',
          type: 'select',
          selectOption: this.costCenterDatas,
          selectKey: 'costCenterCode',
          selectValue: 'costCenterName',
          width: '140px'
        },
        {
          title: '费用类型',
          property: 'feeTypeCode',
          nameProperty: 'feeTypeName',
          type: 'select',
          selectOption: this.feeTypeOptions,
          selectKey: 'feeTypeCode',
          selectValue: 'feeTypeName'
        },
        {
          title: '产品',
          property: 'productCode',
          nameProperty: 'productName',
          type: 'select',
          selectOption: this.productDatas,
          selectKey: 'productCode',
          selectValue: 'productName',
          width: '140px'
        },
        {
          title: '含税金额',
          property: 'amount',
          type: 'number',
          formatter: function (val) {
            if (val.amount !== '') {
              return kiloSplit(val.amount)
            }
            return 0
          }
        },
        {
          title: '不含税金额',
          property: 'amountExcludingTax',
          type: 'number',
          formatter: function (val) {
            if (val.amountExcludingTax !== '') {
              return kiloSplit(val.amountExcludingTax)
            }
            return 0
          }
        },
        {
          title: '税金',
          property: 'amountTax',
          type: 'number',
          formatter: function (val) {
            if (val.amountTax !== '') {
              // return val.amount01
              return kiloSplit(val.amountTax)
            }
            return 0
          }
        },
        {
          title: '其他金额',
          property: 'otherAmount',
          type: 'number',
          formatter: function (val) {
            if (val.otherAmount !== '') {
              // return val.amount01
              return kiloSplit(val.otherAmount)
            }
            return 0
          }
        },
        {
          title: '公司',
          property: 'companyCode'
        },
        {
          title: '往来单位1',
          property: 'contactUnit1'
        },
        {
          title: '往来单位2',
          property: 'contactUnit2'
        },
        {
          title: '说明',
          property: 'summary',
          type: 'textarea',
          width: '160px'
        }
      ]
    }
  },
  watch: {
    commandDialog (cur, old) {
      if (!cur) {
        this.commandTextarea = ''
      }
    },
    hubCommandDialog (cur, old) {
      if (!cur) {
        this.hubchangeForm.textarea = ''
      }
    }
  },
  methods: {
    ...mapActions('costCertificateListView', ['searchDialogData']),
    ...mapActions('costList', ['search', 'createCertificate']),
    ...mapActions('certificateTest', [
      'getFeeType',
      'costCenterData',
      'companySectionData',
      'contactUnitData',
      'getAscriptionFlag1',
      'getAscriptionFlag2',
      'purposeData',
      'productData',
      'sceneData'
    ]),
    // 判断哪个事件
    handleCommand (command, item) {
      console.log('command', command)
      console.log('item.type', item.type)
      this.buttonType = command
      this.commandType = item.type
      this.commandOpt = item.opt
      if (item.type === 'writeOff' || item.type === 'correct') {
        this.hubCommandOpt(item)
      } else if (item.type === 'delete' || item.type === 'certificate') {
        this.unhubCommandOpt(item)
      }
    },
    // 删除操作 and 生成凭证
    unhubCommandOpt (item) {
      let url = ''
      let param = {}
      let opt = ''
      if (this.buttonType === 'select') {
        if (this.selectOptions.length === 0) {
          this.$message.warning('请选择数据')
          return
        }
        let idArr = []
        this.selectOptions.forEach(v => {
          idArr.push(v.id)
        })
        url = api.businessBySelect
        param = { ids: idArr }
        opt = '选择'
      } else if (this.buttonType === 'query') {
        let data = {}
        data.filter = this.$refs.filters.getValue()
        data.filter.fundDirect = this.fundDirect
        data.filter.businessScope = this.businessScope
        url = api.businessbyParam
        param = { filter: { ...data.filter } }
        opt = '条件'
      } else if (this.buttonType === 'input') {
        this.commandTitle = item.titleName
        this.commandDialog = true
        url = api.businessbyInput
        param = {
          itemText: this.commandTextarea
        }
        return
      } else if (this.buttonType === 'scene') {
        this.commandTitle = item.titleName
        this.sceneDialog = true
        url = api.businessbyInput
        this.sceneData().then(res => {
          this.sceneConfigList = res.result || []
        })
        return
      }
      this.$confirm('是否按' + opt + '批量' + item.titleName + '?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        this.$http
          .post(url, {
            ...param,
            type: item.type
          })
          .then(res => {
            if (res.code === 0) {
              this.$message.success(res.message)
              this.handleSearch()
            } else {
              this.$message.warning(res.message)
            }
          })
          .catch(e => {
            console.log(e)
          })
      })
    },
    // 冲销 and 冲正
    hubCommandOpt (item) {
      if (this.buttonType === 'select') {
        if (this.selectOptions.length === 0) {
          this.$message.warning('请选择数据')
          return
        }
      }
      this.commandTitle = item.titleName
      this.hubCommandDialog = true
    },
    handleCancel () {
      this.commandDialog = false
    },
    handleInput () {
      this.$confirm('是否按录入批量' + this.commandOpt + '?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        this.$http
          .post(api.businessbyInput, {
            itemText: this.commandTextarea,
            type: this.commandType
          })
          .then(res => {
            if (res.code === 0) {
              this.$message.success(res.message)
              this.handleSearch()
            } else {
              this.$message.warning(res.message)
            }
          })
          .finally(() => {
            this.commandDialog = false
          })
      })
    },
    handleSceneCertificate () {
      if (!this.sceneId) {
        this.$message.warning('场景不可为空')
        return
      }
      if (!this.commandTextarea) {
        this.$message.warning('录入内容不可为空')
        return
      }
      this.$confirm('是否按场景批量' + this.commandOpt + '?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        this.$http
          .post(api.businessbyInput, {
            itemText: this.commandTextarea,
            type: this.commandType,
            sceneId: this.sceneId
          })
          .then(res => {
            if (res.code === 0) {
              this.$message.success(res.message)
              this.handleSearch()
            } else {
              this.$message.warning(res.message)
            }
          })
          .finally(() => {
            this.sceneDialog = false
          })
      })
    },
    hubhandleCancel () {
      this.hubCommandDialog = false
    },
    provisionFormCancel () {
      this.provisionFormDialog = false
    },
    getProvisionInfo () {
      this.$http
        .post(api.getProvisionInfo, {
          accountMonth: this.provisionForm.accountMonth,
          orderTypeCode: this.fundDirect === 'payment' ? 'bankPayment' : 'bankReceive'
        })
        .then(res => {
          if (res.code === 0) {
            this.provisionForm.info = res.message
          } else {
            this.$message.warning(res.message)
          }
        })
    },
    doProvision () {
      this.$http
        .post(api.doPovision, {
          accountMonth: this.provisionForm.accountMonth,
          orderTypeCode: this.fundDirect === 'payment' ? 'bankPayment' : 'bankReceive'
        })
        .then(res => {
          this.provisionFormDialog = false
          if (res.code === 0) {
            this.$message.success(res.message)
          } else {
            this.$message.warning(res.message)
          }
        })
    },
    hubhandleInput () {
      let url = ''
      let param = {}
      let opt = ''
      if (this.buttonType === 'select') {
        let idArr = []
        this.selectOptions.forEach(v => {
          idArr.push(v.id)
        })
        url = api.businessBySelect
        param = { ids: idArr }
        opt = '选择'
      } else if (this.buttonType === 'query') {
        let data = {}
        data.filter = this.$refs.filters.getValue()
        data.filter.fundDirect = this.fundDirect
        data.filter.businessScope = this.businessScope
        url = api.businessbyParam
        param = { filter: { ...data.filter } }
        opt = '条件'
      } else if (this.buttonType === 'input') {
        url = api.businessbyInput
        param = {
          itemText: this.hubchangeForm.textarea
        }
        opt = '录入'
      }
      this.$confirm('是否按' + opt + '批量' + this.commandOpt + '?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        this.$http
          .post(url, {
            ...param,
            type: this.commandType,
            accountTime: this.hubchangeForm.hubaccountTime
          })
          .then(res => {
            if (res.code === 0) {
              this.$message.success(res.message)
              this.handleSearch()
            } else {
              this.$message.warning(res.message)
            }
          })
          .finally(() => {
            this.hubCommandDialog = false
          })
      })
    },
    handleCurrentChange (pageNum) {
      this.pageNum = pageNum
      this.handleSearch()
    },
    handleSizeChange (pageSize) {
      this.pageSize = pageSize
      this.handleSearch()
    },
    editDetailClick (row) {
      this.$nextTick(() => {
        for (let key in this.detailFormNew) {
          this.detailForm[key] = this.detailFormNew[key]
        }
        this.detailFormList = []
        this.showEditDetailDialog = true
        this.getList(row.id, row.sysCtime)
      })
      this.contactUnitData().then(res => {
        this.contactUnitOptions = res.result || []
      })
      this.getAscriptionFlag1().then(res => {
        this.ascriptionFlagOptions1 = res.result || []
      })
      this.getAscriptionFlag2().then(res => {
        this.ascriptionFlagOptions2 = res.result || []
      })
      this.getFeeType().then(res => {
        this.feeTypeOption = res.result || []
      })
      this.costCenterData().then(res => {
        this.costCenterDataOption = res.result || []
      })
      this.productData().then(res => {
        this.productDataOption = res.result || []
      })
    },
    handleSelectItem (row, col) {
      row[col.nameProperty] = col.selectOption.find(v => v[col.selectKey] === row[col.property])[col.selectValue] || ''
    },
    editSave () {
      this.$refs['detailForm'].validate(valid => {
        if (valid) {
          if (this.detailForm.contactUnit1) {
            this.detailForm.contactUnitName1 =
              this.contactUnitOptions.find(v => v.unitCode === this.detailForm.contactUnit1).unitName || ''
          }
          if (this.detailForm.contactUnit2) {
            this.detailForm.contactUnitName2 =
              this.contactUnitOptions.find(v => v.unitCode === this.detailForm.contactUnit2).unitName || ''
          }
          this.$http
            .post(api.updateBusiness, {
              entries: this.detailFormList,
              head: this.detailForm
            })
            .then(res => {
              this.showEditDetailDialog = false
              if (res.code === 0) {
                this.$message.success(res.message)
              }
            })
        }
      })
    },
    getList (id, sysCtime) {
      this.$http
        .post(api.costDetailSearch, {
          id: id,
          sysCtime: sysCtime
        })
        .then(res => {
          if (res.code === 0) {
            for (let key in res.result.head) {
              if (key !== 'entryList' && key !== 'certificateList') {
                this.$set(this.form, key, res.result.head[key])
              }
            }
            this.detailForm = res.result.head
            this.detailFormList = res.result.entries
            console.log(this.listData, 'listData')
          } else {
            this.$message.warning(res.message)
          }
        })
    },
    handleDetail (row) {
      // this.$router.push(`/fap_receiptpayment_list/${val.settlementNo}`)
      this.dialogDataId = {
        id: row.id,
        sysCtime: row.sysCtime
      }
      console.log(this.dialogDataId, 'ididididid')
      this.showDetailDialog = true
      this.$nextTick(() => {
        this.$refs.costListView.clickMe(this.dialogDataId)
      })
    },
    writeOffDetail (row) {
      this.writeOffDataId = {
        id: row.id,
        sysCtime: row.sysCtime
      }
      this.showWriteOffDialog = true
      this.$nextTick(() => {
        this.$refs.costWriteOffListView.clickMe(this.writeOffDataId)
      })
    },
    handleDetailGoto (row) {
      if (row.settlementNo !== '') {
        this.$router.push(`/$define/fap_receiptpayment_list?orderNo=${row.settlementNo}`)
      }
    },
    handleCertificateDetail (row) {
      // this.$router.push(`/costCertificateList/${row.businessNo}/${row.sysCtime}`)
      this.searchDialogData({ id: row.id, sysCtime: row.sysCtime })
      this.showCertificateDialog = true
    },
    deleteClick (row) {
      this.deleteIds = []
      let obj = {
        id: row.id,
        businessNo: row.businessNo,
        correctingNo: row.correctingNo,
        orderTypeCode: row.orderTypeCode
      }
      this.deleteIds.push(obj)
      this.showDeleteDialog = true
    },
    batchDelete () {
      if (this.selectOptions.length === 0) {
        this.$message.warning('请选择数据')
        return
      }
      let clientSelect = this.selectOptions.find(v => v.clientCode !== 'HANDWORK')
      if (clientSelect) {
        this.$message.warning('请选择手工导入的数据(来源为HANDWORK)')
        return
      }
      let correctingSelect = this.selectOptions.find(v => v.correctingNo !== 1)
      if (correctingSelect) {
        this.$message.warning('选择的数据冲正序号不等于1,表示该数据已经冲正或冲销,不允许删除')
        return
      }
      this.deleteIds = []
      this.selectOptions.forEach(item => {
        let obj = {
          id: item.id,
          businessNo: item.businessNo,
          correctingNo: item.correctingNo,
          orderTypeCode: item.orderTypeCode
        }
        this.deleteIds.push(obj)
      })
      this.showDeleteDialog = true
      console.log(this.deleteIds, 'deleteIds')
    },
    doHandleDelete () {
      this.showDeleteDialog = false
      this.$http.post(api.businessDelete, this.deleteIds).then(res => {
        if (res.code === 0) {
          this.$message.success(res.message)
        } else {
          this.$message.warning(res.message)
        }
        this.handleSearch()
      })
    },
    dataSearch () {
      this.pageNum = 1
      this.handleSearch()
    },
    handleSearch () {
      if (!this.getParams().filter.accountTimeRange && this.getParams().filter.businessNo === '') {
        this.$message.warning('会计日期/业务单据号，不可同时为空')
        return
      }
      this.loading = true
      this.search(this.getParams())
        .then(() => {
          this.loading = false
        })
        .catch(() => {
          this.loading = false
        })
    },
    conditionCertificateCreate () {
      this.showConditionDialog = true
    },
    conditionHandleMulOpt () {
      let data = {}
      data.filter = this.$refs.filters.getValue()
      data.filter.fundDirect = this.fundDirect
      data.filter.businessScope = this.businessScope
      data.pager = {
        pageNum: this.pageNum,
        pageSize: this.pageSize
      }
      this.$http.post(api.certificateCreateByCondition, data).then(res => {
        if (res.code === 0) {
          this.$message.success(res.message)
          this.refleshCb()
        } else {
          this.$message.warning(res.message)
        }
        this.showConditionDialog = false
      })
    },
    handleExport () {
      let data = {}
      data.filter = this.$refs.filters.getValue()
      data.filter.fundDirect = this.fundDirect
      data.filter.businessScope = this.businessScope
      data.filter.fileName = getFileName(this.fundDirect)
      this.$message.warning('正在下载，请稍后...')
      window.open(api.costPayListExport + getParamsUrl(data.filter), '_self')
    },
    initConfirmForm () {
      for (let key in this.confirmForm) {
        this.confirmForm[key] = ''
      }
    },
    handleConfirm (row, index, col, action, cb) {
      this.initConfirmForm()
      this.showConfirmDialog = true
      this.orderNoOptions = []
      // this.form.sysCtime = new Date(row.sysCtime)
      // this.form.paymentTime = new Date()
      // this.form.id = row.id
      this.payConfirmList = [row]
    },
    changePurposeType () {
      let purposeType = this.confirmForm.purposeType
      let companyCode = this.payConfirmList[0].companyCode
      this.$http.post(`${api.getPaymentOrderList}?purposeType=${purposeType}&companyCode=${companyCode}`).then(res => {
        this.orderNoOptions = res.result
        console.log(res, 'purposeTypepurposeTypepurposeTypepurposeType')
      })
    },
    changeOrderNo (row) {
      this.confirmForm.businessNo = row.businessNo
      this.confirmForm.amount = row.amount
      this.confirmForm.remainAmount = row.remainAmount
      this.confirmForm.companyName = row.companyName
      this.confirmForm.bankAccountNumber = row.accountId
      this.confirmForm.bankAccountName = row.accountName
      this.confirmForm.bankName = row.accountBankName
      this.confirmForm.remark = row.remark
      this.confirmForm.id = row.id
      this.confirmForm.receiptTime = row.businessTime
    },
    doHandleConfirm (row, index, col, action, cb) {
      let params = []
      this.payConfirmList.forEach(item => {
        let pushItem = {}
        pushItem.receiptPaymentNo = this.confirmForm.businessNo
        pushItem.receiptPaymentId = this.confirmForm.id
        pushItem.businessNo = item.businessNo
        pushItem.orderTypeCode = item.orderTypeCode
        pushItem.businessId = item.id
        pushItem.orderTypeName = item.orderTypeName
        pushItem.accountTime = moment(this.confirmForm.accountTime).valueOf()
        params.push(pushItem)
      })
      this.confirmLoading = true
      this.$http
        .post(api.paymentConfirm, params)
        .then(res => {
          if (res.code === 0) {
            this.$message.success(res.message)
          } else {
            this.$message.warning(res.message)
          }
          this.confirmLoading = false
          this.showConfirmDialog = false
          this.handleSearch()
        })
        .catch(() => {
          this.confirmLoading = false
        })
    },
    doHandleCorrent () {
      this.showCorrentDialog = false
      let url = ''
      if (this.correctType === '1') {
        url = api.businessCorrent
      } else {
        url = api.businessWriteOff
      }
      this.$http.post(url, this.form).then(res => {
        if (res.code === 0) {
          this.$message.success(res.message)
        } else {
          this.$message.warning(res.message)
        }
        this.handleSearch()
      })
    },
    getParams () {
      let data = {}
      data.filter = this.$refs.filters.getValue()
      data.filter.fundDirect = this.fundDirect
      data.filter.businessScope = this.businessScope
      data.pager = {
        pageNum: this.pageNum,
        pageSize: this.pageSize
      }
      return data
    },
    handleMulOpt () {
      if (this.selectOptions.length === 0) {
        this.$message.warning('请选择数据')
        return
      }
      let businessNoArr = []
      this.selectOptions.forEach(item => {
        let pushItem = {}
        pushItem.businessNo = item.businessNo
        pushItem.sysCtime = item.sysCtime
        pushItem.orderTypeCode = item.orderTypeCode
        pushItem.correctingNo = item.correctingNo
        pushItem.id = item.id
        businessNoArr.push(pushItem)
      })
      console.log(businessNoArr)
      this.createCertificate(businessNoArr)
      this.$message.success('凭证生成中,请稍候查看数据')
    },
    handlePayConfirm () {
      if (this.selectOptions.length === 0) {
        this.$message.warning('请选择数据')
        return
      }
      let cantSelect = this.selectOptions.find(v => v.paymentFlag === 1)
      if (cantSelect) {
        this.$message.warning('选择的数据已收付，请重新选择')
        return
      }
      let cantSelectCorrectingFlag = this.selectOptions.find(v => v.correctingFlag !== 1)
      if (cantSelectCorrectingFlag) {
        this.$message.warning('选择的数据冲正有效为否，请重新选择')
        return
      }
      for (let key in this.confirmForm) {
        this.confirmForm[key] = ''
      }
      let businessNoList = []
      let companySet = new Set()
      this.selectOptions.forEach(item => {
        businessNoList.push(item.businessNo)
        companySet.add(item.companyCode)
      })
      if (companySet.size !== 1) {
        this.$message.warning('所选数据公司不一致，请重新选择')
        return
      }
      const data = new FormData()
      let strParam = businessNoList.toString()
      console.log(strParam, 'strParam')
      data.append('businessNoList', strParam)
      this.$http.post(api.remainAmountSum, data).then(res => {
        if (res.code === 0) {
          this.confirmForm.remainAmountSum = res.result.remainAmountSum.toFixed(2)
          this.confirmForm.paymentAmountSum = res.result.paymentAmountSum.toFixed(2)
          let entryList = res.result.entryList
          this.selectOptions.forEach(item => {
            entryList.forEach(entry => {
              if (item.businessNo === entry.businessNo) {
                item.paymentAmount = entry.paymentAmount
              }
            })
          })
        }
        this.showConfirmDialog = true
      })

      this.confirmForm.amountTotal = this.calAmountlFromSelection('amount')
      this.confirmForm.taxAmountTotal = this.calAmountlFromSelection('amountTax')
      this.confirmForm.amountExcludingTaxTotal = this.calAmountlFromSelection('amountExcludingTax')
      this.confirmForm.otherAmountTotal = this.calAmountlFromSelection('otherAmount')
      this.payConfirmList = this.selectOptions
      // this.selection
    },
    handleMulDownload () {
      if (this.businessScope === 'business') {
        window.open(
          'https://common-1252347619.cosgz.myqcloud.com/template/3b6d7776-290c-481f-969d-1efd64adda4d.xlsx',
          '_self'
        )
      } else if (this.businessScope === 'writeoff') {
        window.open(
          'https://common-1252347619.cosgz.myqcloud.com/common/dfbd078f-6334-43f0-b958-ce799b857359.xlsx',
          '_self'
        )
      }
    },
    handleImport () {
      this.$refs.file.click()
    },
    handleProvisionInfo () {
      this.provisionForm.info = ''
      this.provisionFormDialog = true
    },
    fileChange (e) {
      const fileInput = e.target
      const data = new FormData()
      data.append('file', fileInput.files[0])
      data.append('fundDirect', this.fundDirect)
      data.append('businessScope', this.businessScope)
      let url = api.handworkUpload
      if (this.businessScope === 'writeoff') {
        url = api.writeoffOrderImport
      }
      this.$http
        .post(url, data)
        .then(res => {
          if (res.code === 0) {
            this.$message.success(res.message)
            this.refleshCb()
          } else {
            this.$message.warning(res.message)
          }
        })
        .finally(() => {
          e.target.value = ''
        })
    },
    calAmountlFromSelection (amount) {
      let totalAmount = 0
      totalAmount = this.selectOptions.reduce((pre, curr) => {
        if (typeof curr[amount] === 'number') {
          if (!curr[amount]) {
            curr[amount] = 0
          }
          return parseFloat((pre + curr[amount]).toFixed(2))
        } else {
          return pre
        }
      }, 0)
      return totalAmount.toFixed(2)
    },
    handleSelection (selection, action) {
      this.selectOptions = selection
    },
    selectRadio (selection) {
      this.correctType = selection
    },
    getCostList () {
      this.init()
      if (this.$refs.filters) {
        if (new Date().getDate() < 13) {
          this.$refs.filters.model.accountTimeRange = [
            moment()
              .subtract(1, 'months')
              .startOf('month')
              .format('YYYY-MM-DD'),
            moment()
              .subtract(1, 'months')
              .endOf('month')
              .format('YYYY-MM-DD')
          ]
        } else {
          this.$refs.filters.model.accountTimeRange = [
            moment()
              .startOf('month')
              .format('YYYY-MM-DD'),
            moment().format('YYYY-MM-DD')
          ]
        }
      }
      this.handleSearch()
    },
    setFilters () {
      const val = this.filters
      const orderTypeCodeFilters = val.find(x => x.name === 'orderTypeCode')
      orderTypeCodeFilters.options = this.orderTypeCodes
      const businessTypeCodeFilters = val.find(x => x.name === 'businessTypeCode')
      businessTypeCodeFilters.options = this.businessTypeCodes
      if (this.pageSource !== 'assetsBusiness' && this.businessScope === 'business') {
        this.payConfirmShow = true
      } else if (this.businessScope === 'writeoff') {
        this.payConfirmShow = true
      } else {
        this.payConfirmShow = false
      }
      if (this.businessScope === 'receiptPayment') {
        this.bankDataShow = true
      } else {
        this.bankDataShow = false
      }
    },
    init () {
      this.$watch(val => {
        this.setFilters()
      })
    }
  },
  beforeRouteUpdate (to, from, next) {
    next()
  }
}
</script>
<style scoped>
.el-dropdown-menu__item {
  line-height: 30px;
}
</style>
<style lang="scss">
.cost-list {
  .el-dialog__body {
    max-height: 550px;
    overflow: auto;
  }
  .confirm-form-dialog {
    div.panel-header.clearfix,
    .panel-header .table-header {
      height: 0px;
      padding: 0px;
    }
  }
  .detail-form {
    .el-input {
      width: 200px;
    }
  }
}
</style>

```
