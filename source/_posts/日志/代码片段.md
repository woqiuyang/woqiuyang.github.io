---
title: 代码片段
date: 2022-6-20 10:36:39
cover: 
tags:
- 代码片段
---

# 文件后缀名校验
```java
        if (!"xls,xlsx".contains(file.getOriginalFilename().substring(file.getOriginalFilename().lastIndexOf(".") + 1, file.getOriginalFilename().length()))) {
            return new BaseResult(BaseMessage.INVALID_PARAMETER.getCode(), "只支持excel附件上传", null);
        }
```
# 文件大小限制
```java
 //限制文件300K
        if (file.getSize() > 300 * 1024) {
            return new BaseResult(BaseMessage.INVALID_PARAMETER.getCode(), "文件大小不得超过300K", null);
        }
```
# 集合判断
```java
        if (CollectionUtils.isNotEmpty()) {
```
# 返回json,用于提供给远程api接口
```java
        JSONArray jsonArray = new JSONArray();
        for (LiquidateAccountInfo accountInfo : list) {
            JSONObject jsonObject = new JSONObject();
            jsonObject.put("text", accountInfo.getAccountName());
            jsonObject.put("value", accountInfo.getAccountId());
            jsonArray.add(jsonObject);
        }
        return new BaseResult(BaseMessage.SUCCESS, jsonArray);
```

# 详情
```java
    @ApiOperation(value = "批次详情", notes = "权限码[liquidate:batch:order:view]")
    //@PermissionAnnotation(check = true, functionCodes = {"liquidate:batch:order:view"})
    @PostMapping(value = "/view")
    @ResponseBody
    public BaseResult view(@RequestBody JSONObject request) {
        LiquidateBatchExample example = new LiquidateBatchExample();
        LiquidateBatchExample.Criteria criteria = example.createCriteria();
        if (!request.containsKey("id") || request.getLong("id") == null) {
            return new BaseResult<>(BaseMessage.INVALID_PARAMETER);
        }
        criteria.andIdEqualTo(request.getLongValue("id"));

        List<LiquidateBatch> list = liquidateBatchService.selectByExample(example);
        if (list != null && list.size() > 0) {
            return new BaseResult<>(BaseMessage.SUCCESS, list.get(0));
        } else {
            return new BaseResult<>(BaseMessage.DATA_NOT_EXIST);
        }
    }
```

# 逻辑删除
```java
    @ApiOperation(value = "删除批次", notes = "权限码[liquidate:batch:order:del]")
    //@PermissionAnnotation(check = true, functionCodes = {"liquidate:batch:order:del"})
    @PostMapping(value = "/delete")
    @ResponseBody
    public BaseResult delete(@RequestBody JSONObject request) {
        LiquidateBatchExample example = new LiquidateBatchExample();
        LiquidateBatchExample.Criteria criteria = example.createCriteria();
        if (!request.containsKey("id") || request.getLong("id") == null) {
            return new BaseResult<>(BaseMessage.INVALID_PARAMETER);
        }
        criteria.andIdEqualTo(request.getLongValue("id"));

        List<LiquidateBatch> list = liquidateBatchService.selectByExample(example);
        if (list != null && list.size() > 0) {
            LiquidateBatch batch = list.get(0);
            batch.setDeleteFlag(DeleteFlag.DISABLE.getIndex());
            liquidateBatchService.updateByPrimaryKeySelective(batch);
        }

        return new BaseResult();
    }
```

# json对象解析(返回分页结果)
## 旧
```java
    public BaseResult list(@RequestBody JSONObject request) throws Exception{
        return liquidateBatchService.list(request);
    }
```
```java
    @Override
    public BaseResult list(JSONObject request) throws Exception {
        LiquidateBatchExample example = createQueryExample(request);
        int pageNum = request.get("pageNum") != null ? request.getInteger("pageNum") : 1;
        int pageSize = request.get("pageSize") != null ? request.getInteger("pageSize") : 10;
        long count = getMapper().countByExample(example);
        List<LiquidateBatch> list = selectByExampleForOffsetPage(example, (pageNum - 1) * pageSize, pageSize);
        JSONObject resultData = new JSONObject();
        resultData.put("data", list);
        resultData.put("pageNum", pageNum);
        resultData.put("totalPage", (count % pageSize == 0) ? (count / pageSize) : (count / pageSize + 1));
        resultData.put("totalCount", count);
        return new BaseResult<>(BaseMessage.SUCCESS, resultData);
    }
```
## 新

```java
@Data
public class WofCustomAppListRequestVo<T> {
    private int pageNum;
    private int pageSize;
    private String order;
    private int sort;
    private T filter;


    //解决自定义表单value问题
    public WofCustomAppListRequestVo<T> resolveParam(JSONObject obj, Class<T> t) {
        if (null != obj.get("pageNum")) {
            this.setPageNum(obj.getInteger("pageNum"));
        }
        if (null != obj.get("pageSize")) {
            this.setPageSize(obj.getInteger("pageSize"));
        }
        if (null != obj.get("order")) {
            this.setOrder(obj.getString("order"));
        }
        if (null != obj.get("sort")) {
            this.setSort(obj.getInteger("sort"));
        }
        JSONObject filterJson = obj.getJSONObject("filter");
        T excludeValueObj=null;
        if (null != obj.get("filter")) {
            JSONObject excludeValueJSON = new JSONObject();
            filterJson.forEach((k, v) -> {
                JSONObject valueJson = new JSONObject((Map)v);
                //时间段筛选
                if(null!=valueJson.get("type")){
                    if("daterange".equals(valueJson.getString("type"))){
                        String from=valueJson.getString("from");
                        String to=valueJson.getString("to");
                        if(null!=from){
                            excludeValueJSON.put(k+"Begin",valueJson.getString("from"));
                        }
                        if(null!=to){
                            excludeValueJSON.put(k+"End",valueJson.getString("to"));
                        }
                    }
                    if("array".equals(valueJson.getString("type"))){
                        excludeValueJSON.put(k, valueJson.getJSONArray("value"));
                    }
                }else {
                    excludeValueJSON.put(k, valueJson.get("value"));
                }

            });
            excludeValueObj=JSONObject.toJavaObject(excludeValueJSON, t);
        }
        this.setFilter(excludeValueObj);
        return this;
    }
}
```

```java
    public BaseResult list(@RequestBody JSONObject jsonObject) {
        WofCustomAppListRequestVo vo = new WofCustomAppListRequestVo();
        vo.resolveParam(jsonObject, LiquidateAccountInfo.class);
        return liquidateAccountInfoService.list(vo);
```

```java
    public BaseResult list(WofCustomAppListRequestVo<LiquidateAccountInfo> request) {
        LiquidateAccountInfoExample example = new LiquidateAccountInfoExample();
        LiquidateAccountInfoExample.Criteria criteria = example.createCriteria();
        criteria.andDeleteFlagEqualTo(DeleteFlag.ENABLE.getIndex());
        if (null != request.getFilter()) {
            if (StringUtils.isNotBlank(request.getFilter().getAccountId())) {
                criteria.andAccountIdLike("%" +request.getFilter().getAccountId()+ "%");
            }
        }
        int count = countByExample(example);
        int pageNum = request.getPageNum();
        int pageSize = request.getPageSize();
        List<LiquidateAccountInfo> list = selectByExampleForOffsetPage(example, (pageNum - 1) * pageSize, pageSize);
        BasePageResult basePageResult = new BasePageResult(list, (long) count, pageSize, pageNum);
        BaseResult baseResult = new BaseResult();
        baseResult.setResult(basePageResult);
        return baseResult;
    }
```

# FastJson
BankBusinessType newBusinessType = JSON.parseObject(params.toJSONString(), BankBusinessType.class);

# 批量插入
```java
            Long maxId2 = null;
            while (true) {
                //通过批次号遍历查
                liquidateProvisionDetailExample.clear();
                LiquidateProvisionDetailExample.Criteria criteria = liquidateProvisionDetailExample.createCriteria().andProvisionBatchNoEqualTo(liquidateBatchNo);
                if (null != maxId2) {
                    criteria.andIdGreaterThan(maxId2);
                }
                liquidateProvisionDetailExample.setOrderByClause(" id ");
                PageHelper.offsetPage(0, 100, false);
                List<LiquidateProvisionDetail> liquidateProvisionDetailList = liquidateProvisionDetailMapper.selectByExample(liquidateProvisionDetailExample);
                if (CollectionUtils.isEmpty(liquidateProvisionDetailList)) {
                    break;
                }
                maxId2 = liquidateProvisionDetailList.get(liquidateProvisionDetailList.size() - 1).getId();
                LiquidateFundFlow liquidateFundFlow = new LiquidateFundFlow();
                liquidateFundFlow.setProvisionMonth(thisMonthLastDay);
                liquidateFundFlow.setProvisionBatchNo(liquidateBatchNo);
                liquidateFundFlow.setUpdateBy(UserUtil.getCurrentUser().getAccount());
                liquidateFundFlow.setSysUtime(new Date());
                List<String> collect = liquidateProvisionDetailList.stream().map(liquidateProvisionDetail -> liquidateProvisionDetail.getFlowNo())
                        .collect(Collectors.toList());
                LiquidateFundFlowExample example = new LiquidateFundFlowExample();
                example.createCriteria().andFlowNoIn(collect);
                getMapper().updateByExampleSelective(liquidateFundFlow, example);
            }

```

# 深拷贝
User newUser = JSON.parseObject(JSON.toJSONString(user), User.class);



# Map统计

```java
Map<String, List<BaseOrderTypeConfig>> businessOrderTypeMap = new HashMap<>();
  List<BaseOrderTypeConfig> baseOrderTypeConfigs = baseOrderTypeConfigService.selectByExample(typeConfigExample);
        if (CollectionUtils.isNotEmpty(baseOrderTypeConfigs)) {
            for (BaseOrderTypeConfig config : baseOrderTypeConfigs) {
                //按业务类型
                if (!businessOrderTypeMap.containsKey(config.getBusinessTypeName())) {
                    List<BaseOrderTypeConfig> configList = new ArrayList<>();
                    configList.add(config);
                    businessOrderTypeMap.put(config.getBusinessTypeName(), configList);
                } else {
                    List<BaseOrderTypeConfig> configList = businessOrderTypeMap.get(config.getBusinessTypeName());
                    configList.add(config);
                    businessOrderTypeMap.put(config.getBusinessTypeName(), configList);
                }
            }
```

